<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code Colony - Programa tu Colonia</title>
  </head>
  <body>
    <div id="app">
      <!-- Loading Screen -->
      <div id="loading">
        <h1>ğŸ® Code Colony</h1>
        <p>Cargando...</p>
      </div>

      <!-- Main Game UI -->
      <div id="game-container" style="display: none;">
        
        <!-- Left Panel: Game World -->
        <div id="canvas-panel">
          <div class="panel-header">
            <h3>ğŸ—ºï¸ Mundo del Juego</h3>
            <div id="camera-info">(0, 0) | Zoom: 1.0x</div>
          </div>
          <div id="canvas-container">
            <canvas id="gameCanvas" width="800" height="600"></canvas>
          </div>
          <div class="canvas-controls">
            <button id="resetCameraBtn">ğŸ¯ Centrar CÃ¡mara</button>
            <button id="zoomInBtn">ğŸ” Zoom +</button>
            <button id="zoomOutBtn">ğŸ” Zoom -</button>
          </div>
        </div>

        <!-- Right Panel: Controls -->
        <div id="control-panel">
          
          <!-- Status Card -->
          <div class="card status-card">
            <h3>ğŸ”Œ Estado</h3>
            <div class="status-row">
              <span id="statusDot" class="status-dot"></span>
              <span id="statusText">Desconectado</span>
            </div>
            <div class="stat-row">
              <span>Ping:</span>
              <span id="pingText">--</span>
            </div>
            <div class="stat-row">
              <span>Tick:</span>
              <span id="tickText">--</span>
            </div>
            <div class="stat-row">
              <span>Entidades:</span>
              <span id="entityCount">0</span>
            </div>
            <div class="stat-row energy-stat">
              <span>âš¡ EnergÃ­a:</span>
              <span id="energyText">100</span>
            </div>
          </div>

          <!-- Code Editor - Harvester -->
          <div class="card editor-card">
            <div class="editor-header">
              <h3>ğŸ’» Harvester</h3>
              <span class="cost-tag">Costo: 30âš¡</span>
            </div>
            <div class="editor-help">
              <details>
                <summary>ğŸ“– API Disponible</summary>
                <pre>me.move(x, y)
me.gather(resourceId)
me.transfer(colonyId)
me.log("mensaje")

world.scan(radius)
// Devuelve: [{ id, type, x, y, owner, amount, dist }]</pre>
              </details>
            </div>
            <textarea id="harvesterCode" class="code-editor" spellcheck="false">
// Script del Harvester
const resources = world.scan(300).filter(e => e.type === 'Resource');
const colonies = world.scan(500).filter(e => e.type === 'Colony' && e.owner === 'player1');

if (me.load < me.capacity && resources.length > 0) {
  // Recolectar
  const nearest = resources.sort((a, b) => a.dist - b.dist)[0];
  me.gather(nearest.id);
  me.log("Recolectando de " + nearest.id.substring(0, 8));
} else if (me.load > 0 && colonies.length > 0) {
  // Depositar
  me.transfer(colonies[0].id);
  me.log("Depositando: " + me.load);
}
            </textarea>
            <button class="deploy-btn" data-unit="Harvester">ğŸš€ Subir CÃ³digo</button>
          </div>

          <!-- Code Editor - Warrior -->
          <div class="card editor-card">
            <div class="editor-header">
              <h3>âš”ï¸ Warrior</h3>
              <span class="cost-tag">Costo: 50âš¡</span>
            </div>
            <div class="editor-help">
              <details>
                <summary>ğŸ“– API Disponible</summary>
                <pre>me.move(x, y)
me.attack(enemyId)
me.log("mensaje")

world.scan(radius)
// Devuelve: [{ id, type, x, y, hp, owner, dist }]</pre>
              </details>
            </div>
            <textarea id="warriorCode" class="code-editor" spellcheck="false">
// Script del Warrior
const enemies = world.scan(150).filter(e => 
  e.owner === 'enemy' && e.type === 'Monster'
);

if (enemies.length > 0) {
  const nearest = enemies.sort((a, b) => a.dist - b.dist)[0];
  
  if (me.isReady && nearest.dist <= me.range) {
    me.attack(nearest.id);
    me.log("Atacando!");
  } else {
    me.move(nearest.x, nearest.y);
  }
} else {
  // Patrullar alrededor de la base
  const angle = Date.now() / 1000;
  me.move(Math.cos(angle) * 80, Math.sin(angle) * 80);
}
            </textarea>
            <button class="deploy-btn" data-unit="Warrior">ğŸš€ Subir CÃ³digo</button>
          </div>

          <!-- Actions Card -->
          <div class="card actions-card">
            <h3>ğŸ® Acciones</h3>
            <button class="action-btn spawn-btn" data-unit="Harvester">
              ğŸšœ Crear Harvester (30âš¡)
            </button>
            <button class="action-btn spawn-btn" data-unit="Warrior">
              âš”ï¸ Crear Warrior (50âš¡)
            </button>
            <hr>
            <button class="action-btn danger-btn" id="resetBtn">
              ğŸ’€ Reiniciar Mundo
            </button>
          </div>

          <!-- Logs Card -->
          <div class="card logs-card">
            <h3>ğŸ“œ Logs</h3>
            <div id="logArea"></div>
            <button id="clearLogsBtn" class="clear-btn">ğŸ—‘ï¸ Limpiar</button>
          </div>

        </div>

      </div>

      <!-- Game Over Modal -->
      <div id="gameOverModal" class="modal">
        <div class="modal-content game-over">
          <div class="game-over-title">GAME OVER</div>
          <div class="game-over-subtitle" id="gameOverReason">
            Tu colonia ha sido destruida
          </div>
          <div class="game-over-stats" id="gameOverStats">
            <div class="stat">Ticks Sobrevividos: <span id="finalTicks">0</span></div>
            <div class="stat">EnergÃ­a MÃ¡xima: <span id="maxEnergy">0</span></div>
          </div>
          <div class="modal-buttons">
            <button class="modal-btn primary" id="restartBtn">
              ğŸ”„ Reiniciar Juego
            </button>
            <button class="modal-btn" id="closeModalBtn">
              ğŸ“Š Cerrar
            </button>
          </div>
        </div>
      </div>

    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>